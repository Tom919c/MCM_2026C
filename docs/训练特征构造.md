## 一、datas 数据字典

所有训练数据放在 `datas['train_data']` 下。

### 1.1 维度信息

```python
train_data = datas['train_data']

train_data['n_obs']         # int: 观测总数（选手-周 组合）
train_data['n_weeks']       # int: 周总数（所有赛季累计）
train_data['n_celebs']      # int: 名人总数
train_data['n_pros']        # int: 职业舞者总数
train_data['n_seasons']     # int: 赛季总数（用于交叉验证）
```

### 1.2 索引数组（用于分层结构）

所有索引从 0 开始，类型为 `np.int32`。

```python
train_data['celeb_idx']     # shape: [n_obs], 每条观测对应的名人ID
train_data['pro_idx']       # shape: [n_obs], 每条观测对应的舞者ID
train_data['week_idx']      # shape: [n_obs], 每条观测对应的周ID（全局唯一）
train_data['season_idx']    # shape: [n_obs], 每条观测对应的赛季ID（用于交叉验证）
```

### 1.3 特征矩阵

所有特征矩阵类型为 `np.float32`，所有连续特征需标准化（均值0，标准差1）。

| 特征矩阵  | 形状          | 说明       |
| --------- | ------------- | ---------- |
| `X_celeb` | [n_celebs, ?] | 名人特征   |
| `X_pro`   | [n_pros, ?]   | 舞者特征   |
| `X_obs`   | [n_obs, ?]    | 观测级特征 |

每个特征矩阵需附带名称列表：

```python
train_data['X_celeb_names']  # list[str]
train_data['X_pro_names']    # list[str]
train_data['X_obs_names']    # list[str]
```

其中各个列表包含的信息如下：

观测级特征：pro_prev_wins，pro_avg_rank，same_sex_pair，z_score，score_trend，is_top_score，perfect_score，judge_score_stddev，times_in_bottom，cumulative_avg_score，teflon_factor，weeks_survived，season_era，rule_method，judge_save_active

职业舞者特征：pro_id，is_male

名人特征：is_male
age
age_squared
age_centered
age_bucket_young
age_bucket_mid
age_bucket_old
industry_Business, Controversial & Special Roles
industry_Fashion, Beauty & Modeling
industry_Media, News & Communication
industry_Music & Dance
industry_Performing Arts & Entertainment
industry_Public Service & Specialized Professions
industry_Sports & Physical Performance
is_international
log_us_state_pop

### 1.4 淘汰规则相关数据（似然函数用）

用于计算综合得分 $S_{i,w}$，与两种淘汰规则对应：

```python
# 百分比法 (rule_method=1): S = judge_score_pct + P_fan
train_data['judge_score_pct']   # shape: [n_obs], 评委分占当周总分的比例

# 排名法 (rule_method=0): S = judge_rank_score + fan_rank_score
train_data['judge_rank_score']  # shape: [n_obs], 评委排名分 = (n_contestants - rank) / (n_contestants - 1)
```

**注意**：这些不是预测 μ 的特征，是赛制规则计算淘汰时的输入。

### 1.5 周级结构信息（似然函数需要）

```python
train_data['week_data']         # list[dict], 长度为 n_weeks
```

每个元素的结构：

```python
{
    'obs_mask': np.ndarray,       # shape: [n_obs], bool, 该周参赛选手的掩码
    'n_contestants': int,          # 该周参赛人数
    'n_eliminated': int,           # 该周淘汰人数
    'eliminated_mask': np.ndarray, # shape: [n_obs], bool, 被淘汰选手的掩码
    'rule_method': int,            # 0=排名法, 1=百分比法
    'judge_save_active': bool,     # 是否有评委拯救环节
}
```

---